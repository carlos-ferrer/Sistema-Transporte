<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roteiro de Viagens</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style> 
        body { font-family: 'Inter', sans-serif; } 
        .autocomplete-suggestions { border: 1px solid #ddd; max-height: 150px; overflow-y: auto; position: absolute; width: 100%; z-index: 10; }
    </style>
</head>
<body class="bg-gray-100">
<div class="flex h-screen bg-gray-200 font-sans">
    <!-- Sidebar -->
    <div id="sidebar" class="h-full p-4 bg-white shadow-lg w-64 fixed lg:static -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out z-20">
        <div class="flex items-center border-b pb-4">
            <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
            <h1 class="text-xl font-bold text-gray-800 ml-3">Sistema de Viagem</h1>
        </div>
        <nav class="mt-6">
            <a href="cadastro_viagem.html" class="flex items-center py-2 px-4 text-gray-600 rounded-lg hover:bg-gray-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                <span class="mx-3">Cadastro de Viagem</span>
            </a>
            <a href="roteiro.html" class="flex items-center py-2 px-4 mt-4 text-gray-700 bg-gray-100 rounded-lg border-r-4 border-blue-500">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-1.447-.894L15 7m-6 3l6-3"></path></svg>
                <span class="mx-3 font-semibold">Roteiro de Viagens</span>
            </a>
            <a href="solicitacoes_pendentes.html" class="flex items-center py-2 px-4 mt-4 text-gray-600 rounded-lg hover:bg-gray-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                <span class="mx-3">Solicitações Pendentes</span>
            </a>
        </nav>
    </div>
    <!-- Content -->
    <div class="flex-1 flex flex-col">
        <header class="bg-white shadow flex items-center justify-between p-4">
            <h1 class="text-xl font-bold text-gray-800">Roteiro de Viagens</h1>
            <button id="menu-button" class="text-gray-500 focus:outline-none lg:hidden">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </header>
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-gray-100 p-4 sm:p-6 lg:p-8">
            <div class="w-full bg-white p-6 rounded-2xl shadow-lg">
                <div class="flex flex-col md:flex-row justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 md:mb-0">Viagens Criadas</h2>
                    <a href="criar_roteiro.html" class="w-full md:w-auto bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 text-center">
                        + Novo Roteiro
                    </a>
                </div>
                <!-- Filtros -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6 p-4 bg-gray-50 rounded-lg border">
                    <input type="date" id="filter-date" class="p-2 border rounded-lg" title="Filtrar por data">
                    <input type="text" id="filter-vehicle" placeholder="Filtrar por veículo..." class="p-2 border rounded-lg">
                    <div class="relative">
                        <input type="text" id="filter-destination" placeholder="Filtrar por destino..." class="w-full p-2 border rounded-lg" autocomplete="off">
                        <div id="city-suggestions" class="autocomplete-suggestions bg-white rounded-md shadow-lg hidden"></div>
                    </div>
                    <input type="text" id="filter-driver" placeholder="Filtrar por motorista..." class="p-2 border rounded-lg">
                </div>
                <!-- Lista de Roteiros -->
                <div id="itineraries-list" class="space-y-4">
                    <!-- Roteiros serão inseridos aqui pelo JavaScript -->
                </div>
            </div>
        </main>
    </div>
    <div id="sidebar-overlay" class="hidden fixed inset-0 bg-black opacity-50 z-10 lg:hidden"></div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Lógica do Menu
        const menuButton = document.getElementById('menu-button');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebar-overlay');
        if (menuButton) menuButton.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });
        if (overlay) overlay.addEventListener('click', () => {
            sidebar.classList.toggle('-translate-x-full');
            overlay.classList.toggle('hidden');
        });

        const itinerariesList = document.getElementById('itineraries-list');
        const filterDate = document.getElementById('filter-date');
        const filterVehicle = document.getElementById('filter-vehicle');
        const filterDestination = document.getElementById('filter-destination');
        const filterDriver = document.getElementById('filter-driver');

        const ITINERARIES_KEY = 'travelItineraries';
        
        // Autocomplete para destino
        const suggestionsContainer = document.getElementById('city-suggestions');

        const allCities = [
            "Adamantina - SP", "Alto Garças - MT", "Álvares Machado - SP", "Araçatuba - SP",
            "Assis - SP", "Avaré - SP", "Barretos - SP", "Bauru - SP", "Botucatu - SP",
            "Campinas - SP", "Cândido Mota - SP", "Chavantes - SP", "Fernandópolis - SP",
            "Franca - SP", "Garça - SP", "Herculândia - SP", "Ilha Solteira - SP", "Jales - SP",
            "Jaú - SP", "Jundiaí - SP", "Londrina - PR", "Marialva - PR", "Marília - SP",
            "Osvaldo Cruz - SP", "Ourinhos - SP", "Palmital - SP", "Paraguaçu Paulista - SP",
            "Pardinho - SP", "Penápolis - SP", "Pirapozinho - SP", "Presidente Prudente - SP",
            "Presidente Venceslau - SP", "Rancharia - SP", "Ribeirão Preto - SP", "Rosana - SP",
            "Salto - SP", "Santa Cruz do Rio Pardo - SP", "Santos - SP",
            "São José do Rio Preto - SP", "São Paulo - SP", "Sorocaba - SP", "Tarumã - SP",
            "Taubaté - SP", "Tupã - SP", "Valinhos - SP"
        ];

        filterDestination.addEventListener('input', () => {
            const query = filterDestination.value.toUpperCase();
            suggestionsContainer.innerHTML = '';
            if (!query) {
                suggestionsContainer.classList.add('hidden');
                return;
            }
            const filteredCities = allCities.filter(city => city.toUpperCase().includes(query));
            if (filteredCities.length > 0) {
                suggestionsContainer.classList.remove('hidden');
                filteredCities.forEach(city => {
                    const suggestionEl = document.createElement('div');
                    suggestionEl.textContent = city;
                    suggestionEl.classList.add('p-2', 'cursor-pointer', 'hover:bg-gray-100');
                    suggestionEl.addEventListener('click', () => {
                        filterDestination.value = city;
                        suggestionsContainer.classList.add('hidden');
                        renderItineraries();
                    });
                    suggestionsContainer.appendChild(suggestionEl);
                });
            } else {
                suggestionsContainer.classList.add('hidden');
            }
        });
        
        document.addEventListener('click', (e) => { if (!e.target.closest('.relative')) { suggestionsContainer.classList.add('hidden'); } });

        function renderItineraries() {
            const itineraries = JSON.parse(localStorage.getItem(ITINERARIES_KEY)) || [];
            const filters = {
                date: filterDate.value,
                vehicle: filterVehicle.value.toLowerCase(),
                destination: filterDestination.value.toLowerCase(),
                driver: filterDriver.value.toLowerCase()
            };

            const filteredItineraries = itineraries.filter(it => {
                const hasMatchingPatient = it.patients.some(p => p.city.toLowerCase().includes(filters.destination));
                return (
                    (!filters.date || it.date === filters.date) &&
                    (!filters.vehicle || it.vehicle.toLowerCase().includes(filters.vehicle)) &&
                    (!filters.destination || hasMatchingPatient) &&
                    (!filters.driver || it.driver.toLowerCase().includes(filters.driver))
                );
            });

            itinerariesList.innerHTML = '';
            if (filteredItineraries.length === 0) {
                itinerariesList.innerHTML = '<p class="text-gray-500 text-center col-span-full">Nenhum roteiro encontrado para os filtros selecionados.</p>';
                return;
            }

            filteredItineraries.forEach(it => {
                const itineraryCard = document.createElement('div');
                itineraryCard.className = 'bg-gray-50 p-4 rounded-lg border grid grid-cols-1 md:grid-cols-5 gap-4 items-center transition hover:shadow-md';
                const destinations = [...new Set(it.patients.map(p => p.city))].join(', ');
                itineraryCard.innerHTML = `
                    <div><span class="font-bold text-gray-800">${new Date(it.date + 'T00:00:00').toLocaleDateString('pt-BR')}</span><p class="text-sm text-gray-500">Data</p></div>
                    <div><span class="font-semibold text-gray-700">${destinations}</span><p class="text-sm text-gray-500">Destino(s)</p></div>
                    <div><span class="text-gray-600">${it.vehicle}</span><p class="text-sm text-gray-500">Veículo</p></div>
                    <div><span class="text-gray-600">${it.driver}</span><p class="text-sm text-gray-500">Motorista</p></div>
                    <div class="flex items-center justify-end gap-2">
                         <button title="Visualizar" class="view-btn p-2 rounded-full hover:bg-blue-100 text-blue-600" data-id="${it.id}"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path></svg></button>
                         <button title="Editar" class="edit-btn p-2 rounded-full hover:bg-green-100 text-green-600" data-id="${it.id}"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg></button>
                         <button title="Remover" class="delete-btn p-2 rounded-full hover:bg-red-100 text-red-600" data-id="${it.id}"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg></button>
                    </div>
                `;
                itinerariesList.appendChild(itineraryCard);
            });
            document.querySelectorAll('.delete-btn').forEach(btn => btn.addEventListener('click', (e) => {
                const id = e.currentTarget.dataset.id;
                if (confirm('Tem certeza que deseja remover este roteiro? Os pacientes voltarão ao status "Pendente".')) deleteItinerary(id);
            }));
        }
        
        function deleteItinerary(id) {
             let itineraries = JSON.parse(localStorage.getItem(ITINERARIES_KEY)) || [];
             let requests = JSON.parse(localStorage.getItem('travelRequests')) || [];
             const itineraryToDelete = itineraries.find(it => it.id == id);
             if (itineraryToDelete) {
                 const patientIds = itineraryToDelete.patients.map(p => p.id);
                 requests.forEach(req => { if (patientIds.includes(req.id)) { req.status = 'Pendente'; } });
                 localStorage.setItem('travelRequests', JSON.stringify(requests));
             }
             itineraries = itineraries.filter(it => it.id != id);
             localStorage.setItem(ITINERARIES_KEY, JSON.stringify(itineraries));
             renderItineraries();
        }

        [filterDate, filterVehicle, filterDestination, filterDriver].forEach(input => input.addEventListener('input', renderItineraries));
        renderItineraries();
    });
</script>
</body>
</html>

